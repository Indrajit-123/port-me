/*
 *	jQuery FullCalendar Extendable Plugin
 *	An Ajax (PHP - Mysql - jquery) script that extends the functionalities of the fullcalendar plugin
 *  Dependencies: 
 *   - jquery
 *   - jquery Ui
 * 	 - jquery spectrum (since 2.0)
 *   - jquery timepicker (since 1.6.4)
 *   - jquery Fullcalendar
 *   - Twitter Bootstrap
 *  Author: Paulo Regina
 *  Website: www.pauloreg.com
 *  Contributions: Patrik Iden, Jan-Paul Kleemans, Bob Mulder
 *	Version 3.0, February - 2017
 *  Fullcalendar 3.2.0
 *	Released Under Envato Regular or Extended Licenses
 */
 
 !function(a,b){a.fn.extend({FullCalendarExt:function(c){function h(){value=a(g.formSearchSelector+" input").val(),construct="search="+encodeURIComponent(value),a.post("includes/loader.php",construct,function(b){a(g.calendarSelector).fullCalendar("refetchEvents")})}var d="token="+a("#cal_token").val(),e={calendarSelector:"#calendar",lang:"en",token:"",ajaxJsonFetch:"includes/cal_events.php?"+d,ajaxUiUpdate:"includes/cal_update.php?"+d,ajaxEventQuickSave:"includes/cal_quicksave.php?"+d,ajaxEventDelete:"includes/cal_delete.php?"+d,ajaxEventEdit:"includes/cal_edit_update.php?"+d,ajaxEventExport:"includes/cal_export.php?"+d,ajaxRepeatCheck:"includes/cal_check_rep_events.php?"+d,ajaxRetrieveDescription:"includes/cal_description.php?"+d,ajaxImport:"importer.php?"+d,modalSelector:"#calendarModal",modalPromptSelector:"#cal_prompt",modalEditPromptSelector:"#cal_edit_prompt_save",formSearchSelector:"form#search",formAddEventSelector:"form#add_event",formFilterSelector:"form#filter-category select",formEditEventSelector:"form#edit_event",formSearchSelector:"form#search",newEventText:"Add New Event",successAddEventMessage:"Successfully Added Event",successDeleteEventMessage:"Successfully Deleted Event",successUpdateEventMessage:"Successfully Updated Event",failureAddEventMessage:"Failed To Add Event",failureDeleteEventMessage:"Failed To Delete Event",failureUpdateEventMessage:"Failed To Update Event",generalFailureMessage:"Failed To Execute Action",ajaxError:"Failed to load content",emptyForm:"Form cannot be empty",eventText:"Event: ",repetitiveEventActionText:"This is a repetitive event, what do you want to do?",isRTL:!1,weekNumberTitle:"W",defaultColor:"#587ca3",weekType:"agendaWeek",dayType:"agendaDay",listType:"listWeek",editable:!0,ignoreTimezone:!0,lazyFetching:!0,filter:!0,quickSave:!0,navLinks:!0,firstDay:0,gcal:!1,version:"modal",defaultView:"month",aspectRatio:1.35,weekends:!0,weekNumbers:!1,weekNumberCalculation:"iso",hiddenDays:[],theme:!1,themePrev:"circle-triangle-w",themeNext:"circle-triangle-e",titleFormatMonth:"",titleFormatWeek:"",titleFormatDay:"",columnFormatMonth:"",columnFormatWeek:"",columnFormatDay:"",timeFormat:"H:mm",weekMode:!0,allDaySlot:!0,allDayText:"all-day",axisFormat:"h(:mm)a",slotDuration:"00:30:00",minTime:"00:00:00",maxTime:"24:00:00",slotEventOverlap:!0,savedRedirect:"index.php",removedRedirect:"index.php",updatedRedirect:"index.php",ajaxLoaderMarkup:'<div class="loadingDiv"></div>',prev:"left-single-arrow",next:"right-single-arrow",prevYear:"left-double-arrow",nextYear:"right-double-arrow",otherSource:"",modalFormBody:a("#modal-form-body").html(),eventLimit:!0,eventLimitClick:"popover",palette:[["#0b57a4","#8bbdeb","#000000","#2a82d7","#148aa5","#3714a4","#587ca3","#a50516"],["#fb3c8f","#1b4f15","#1b4f15","#686868","#3aa03a","#ff0080","#fee233","#fc1cad"],["#7f2b14","#000066","#2b4726","#fd7222","#fc331c","#af31f2","#fc0d1b","#2b8a6d"],["#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#9fc5e8","#b4a7d6","#d5a6bd"]]},f=a.extend(e,c),g=f;1==g.gcal&&(g.weekType="",g.dayType=""),a(g.calendarSelector).fullCalendar({locale:g.lang,editable:g.editable,eventLimit:g.eventLimit,eventLimitClick:g.eventLimitClick,navLinks:g.navLinks,defaultView:g.defaultView,aspectRatio:g.aspectRatio,weekends:g.weekends,weekNumbers:g.weekNumbers,weekNumberCalculation:g.weekNumberCalculation,weekNumberTitle:g.weekNumberTitle,views:{month:{titleFormat:g.titleFormatMonth,columnFormat:g.columnFormatMonth},week:{titleFormat:g.titleFormatWeek,columnFormat:g.columnFormatWeek},day:{titleFormat:g.titleFormatDay,columnFormat:g.columnFormatDay}},isRTL:g.isRTL,hiddenDays:g.hiddenDays,theme:g.theme,buttonIcons:{prev:g.prev,next:g.next,prevYear:g.prevYear,nextYear:g.nextYear},themeButtonIcons:{prev:g.themePrev,next:g.themeNext},allDaySlot:g.allDaySlot,allDayText:g.allDayText,slotLabelFormat:g.axisFormat,slotDuration:g.slotDuration,minTime:g.minTime,maxTime:g.maxTime,slotEventOverlap:g.slotEventOverlap,fixedWeekCount:g.weekMode,timeFormat:g.timeFormat,header:{left:"prev,next",center:"title",right:"month,"+g.weekType+","+g.dayType+","+g.listType},monthNames:g.monthNames,monthNamesShort:g.monthNamesShort,dayNames:g.dayNames,dayNamesShort:g.dayNamesShort,buttonText:{today:g.today,month:g.month,week:g.week,day:g.day},ignoreTimezone:g.ignoreTimezone,firstDay:g.firstDay,lazyFetching:g.lazyFetching,selectable:g.quickSave,selectHelper:g.quickSave,select:function(b,c,d,e){calendar.view=e.name,"modal"==g.version&&(calendar.quickModal(b,c,d),a(g.calendarSelector).fullCalendar("unselect"))},eventSources:[g.otherSource,{url:g.ajaxJsonFetch}],eventDrop:function(b){var c=moment(b.start).format("YYYY-MM-DD"),d=moment(b.start).format("HH:mm"),e=moment(b.end).format("YYYY-MM-DD"),f=moment(b.end).format("HH:mm"),h=moment(b.end).isValid();null===b.end||"null"===b.end||0==h?(Eend=c+" "+d,EaD=b.allDay):(Eend=e+" "+f,EaD=b.allDay);var i="start="+c+" "+d+"&end="+Eend+"&id="+b.id+"&allDay="+EaD+"&original_id="+b.original_id;a.post(g.ajaxUiUpdate,i,function(b){a(g.calendarSelector).fullCalendar("refetchEvents")})},eventResize:function(b){var c=moment(b.start).format("YYYY-MM-DD"),d=moment(b.start).format("HH:mm"),e=moment(b.end).format("YYYY-MM-DD"),f=moment(b.end).format("HH:mm"),h=moment(b.end).isValid();null===b.end||"null"===b.end||0==h?(Eend=c+" "+d,EaD="false"):(Eend=e+" "+f,EaD=b.allDay);var i="start="+c+" "+d+"&end="+Eend+"&id="+b.id+"&allDay="+EaD+"&original_id="+b.original_id;a.post(g.ajaxUiUpdate,i,function(b){a(g.calendarSelector).fullCalendar("refetchEvents")})},eventRender:function(a,b,c){var d=a.color,e=moment(a.start).format("YYYY-MM-DD"),f=moment(a.start).format("HH:mm"),h=moment(a.end).format("YYYY-MM-DD"),i=moment(a.end).format("HH:mm"),j=moment(a.end).isValid();if(0==j)var h=e,i=f;null!==a.end&&"month"==c.name&&("H:mm"!=g.timeFormat&&"h:mm"!=g.timeFormat||(timeformat=a.start.format("H:mm")+" - "+a.end.format("H:mm"),b.find(".fc-time").html(timeformat))),"modal"==g.version&&(b.attr("data-toggle","modal"),b.attr("href","javascript:void(0)"),b.attr("onclick",'calendar.openModal("'+a.title+'","'+a.url+'","'+a.original_id+'","'+a.id+'","'+a.start+'","'+a.end+'","'+d+'","'+e+'","'+f+'","'+h+'","'+i+'");'))}}),calendar.openModal=function(c,d,e,f,h,i,j,k,l,m,n){a("#modal-form-body").hide(),a("#details-body").show(),calendar.title=c,calendar.id=e,calendar.rep_id=f,calendar.eventStart=h,calendar.eventEnd=i,ExpS=k+" "+l,ExpE=m+" "+n,a.ajax({type:"POST",url:g.ajaxRetrieveDescription,data:{id:calendar.id,mode:"edit"},cache:!1,beforeSend:function(){a(".loadingDiv").show(),a(".modal-footer").hide()},error:function(){a(".loadingDiv").hide(),alert(g.ajaxError)},success:function(d){a(".loadingDiv").hide();var e=a.parseJSON(d),f=e.description.replace("$null",""),h=e.color.replace("$null",""),i=e.category.replace("$null","");calendar.description_editable=e.description_editable.replace("&amp;","&"),calendar.description=f.replace("&amp;","&"),calendar.category=i.replace("&amp;","&"),calendar.color=h,calendar.data=e;var j=JSON.parse(JSON.stringify(e));a("#details-body-title").html(c),calendar.removeObjProp(j,["all-day","categorie","categories","category","color","description","description_editable","end","start","id","repeat_id","repeat_type","title","url","user_id"]);var k="";if(a(".custom-fields").children().length>0&&Object.keys(j).length>0){k="<hr />";for(var l in j){var m=j[l];"file"==l&&(m=m!==b&&"undefined"!==m?'<a href="'+m+'">'+m+"</a>":""),k+="<p><strong>"+l+": </strong>"+m+"</p>"}}a("#details-body-content").html(f+k),a("#export-event, #delete-event, #edit-event").show(),a("#save-changes, #add-event").hide(),a(".modal-footer").show(),a(g.modalSelector).modal("show")}}),a("#delete-event").off().on("click",function(a){calendar.remove(calendar.id),a.preventDefault()}),a("#export-event").off().on("click",function(a){calendar.exportIcal(calendar.id,calendar.title,calendar.description,ExpS,ExpE),a.preventDefault()}),a("#edit-event").off().on("click",function(c){document.getElementById("modal-form-body").reset(),a("#modal-form-body").html(g.modalFormBody),a("#export-event, #delete-event, #edit-event, #add-event").hide(),a("#save-changes").show().css("width","100%"),a("#details-body, #event-type-select").hide(),a("#repeat-type-select, #repeat-type-selected").hide(),a("#event-type-selected").show(),a("#modal-form-body").show(),a(g.modalSelector).modal("show"),a("#modal-form-body :input").each(function(){var c=a(this).attr("name"),d=a(this)[0].tagName;switch(d){case"SELECT":var e=calendar.data[c];e!==b&&a('option[value="'+e.replace("&amp;","&")+'"]').attr("selected","selected");break;case"INPUT":var c=c.replace(/\[.*?\]/g,""),f=a(this).attr("type"),e=calendar.data[c];if("checkbox"==f&&e!==b)for(var g=e.split(","),h=0;h<g.length;h++)a('input[value="'+g[h].trim()+'"]').attr("checked","checked");"radio"==f&&e!==b&&a('input[value="'+e+'"]').attr("checked","checked"),"file"==f&&e!==b&&"undefined"!==e&&a(this).before('<p class="file-attachment"><a href="'+e+'">'+e+"</a></p>"),"text"==f&&(a('input[name="'+c+'"]').val(calendar.data[c]),a("input[name=title]").val(calendar.data.title),a("#colorp").spectrum("set",calendar.data.color),a("#startDate").val(k),a("input#startTime").val(l),a("#endDate").val(m),a("input#endTime").val(n));break;case"TEXTAREA":var e=calendar.data[c];a('textarea[name="'+c+'"]').val(e),a('textarea[name="description"]').val(calendar.data.description_editable);break;default:a(':input[name="'+c+'"]').val(calendar.data[c])}}),a("#save-changes").off().on("click",function(b){0==a("input[name=title]").val().length?alert(g.emptyForm):(editFormData=new FormData(a("#modal-form-body").get(0)),a("#file")[0]&&editFormData.append("file",a("#file")[0].files[0]),calendar.update(e,editFormData)),b.preventDefault()})})},calendar.quickModal=function(b,c,d){document.getElementById("modal-form-body").reset(),a("#modal-form-body").html(g.modalFormBody);var e=moment(b).format("YYYY-MM-DD"),f=moment(b).format("HH:mm"),h=moment(c).format("YYYY-MM-DD"),i=moment(c).format("HH:mm"),j=moment(c).isValid();if(0==j)var h=e,i=f;a("#startDate").val(e),a("#startTime").val(f),a("#endDate").val(h),a("#endTime").val(i),a("#details-body").hide(),a("#event-type-select").show(),a("#event-type-selected").hide(),a("#repeat-type-select").show(),a("#repeat-type-selected").hide(),a("#export-event, #delete-event, #edit-event, #save-changes").hide(),a("#add-event").show().css("width","100%"),a(".modal-footer").show(),a("#modal-form-body").show(),a("#details-body-title").html(g.newEventText),a(g.modalSelector).modal("show"),a("#event-type").on("change",function(){var b=a(this).val();"false"==b?(a("#event-type-select").show(),a("#event-type-selected").show()):"true"==b&&(a("#event-type-select").show(),a("#event-type-selected").hide())}),a("#repeat_select").on("change",function(){var b=a(this).val();"no"!==b?(a("#repeat-type-select").show(),a("#repeat-type-selected").show()):"no"==b&&(a("#repeat-type-select").show(),a("#repeat-type-selected").hide())}),a("#add-event").off().on("click",function(b){0==a("input[name=title]").val().length?alert(g.emptyForm):(formData=new FormData(a("#modal-form-body").get(0)),a("#file")[0]&&formData.append("file",a("#file")[0].files[0]),calendar.quickSave(formData)),b.preventDefault()})},calendar.quickSave=function(b){a.ajax({url:g.ajaxEventQuickSave,data:b,type:"POST",cache:!1,processData:!1,contentType:!1,beforeSend:function(){a(".loadingDiv").show(),a(".modal-footer").hide()},error:function(){a(".loadingDiv").hide(),alert(g.ajaxError)},success:function(b){a(".loadingDiv").hide(),1==b?(a(g.modalSelector).modal("hide"),a(g.calendarSelector).fullCalendar("refetchEvents")):(alert(g.failureAddEventMessage),a(".modal-footer").show())}})},calendar.update=function(b,c){var d="id="+b;a.ajax({type:"POST",url:g.ajaxRepeatCheck,data:d,cache:!1,beforeSend:function(){a(".loadingDiv").show()},error:function(){a(".loadingDiv").hide(),alert(g.ajaxError)},success:function(d){a(".loadingDiv").hide(),"REP_FOUND"==d?(a(g.modalSelector).modal("hide"),a(g.modalEditPromptSelector+" .modal-header").html("<h4>"+g.eventText+calendar.title+"</h4>"),a(g.modalEditPromptSelector+" .modal-body-custom").css("padding","15px").html(g.repetitiveEventActionText),a(g.modalEditPromptSelector).modal("show"),a('[data-option="save-this"]').unbind("click").on("click",function(d){calendar.update_this(b,c),a(g.modalEditPromptSelector).modal("hide"),a(g.modalSelector).modal("hide"),d.preventDefault()}),a('[data-option="save-repetitives"]').unbind("click").on("click",function(d){var e="true";calendar.update_this(b,c,e),a(g.modalEditPromptSelector).modal("hide"),a(g.modalSelector).modal("hide"),d.preventDefault()})):calendar.update_this(b,c)},error:function(a){alert(g.generalFailureMessage)}})},calendar.update_this=function(c,d,e){e===b?editFormData.append("id",c):(editFormData.append("id",c),editFormData.append("rep_id",calendar.rep_id),editFormData.append("method","repetitive_event")),a.ajax({type:"POST",url:g.ajaxEventEdit,data:d,cache:!1,processData:!1,contentType:!1,beforeSend:function(){a(".loadingDiv").show()},error:function(){a(".loadingDiv").hide(),alert(g.ajaxError)},success:function(b){a(".loadingDiv").hide(),""==b?(a(g.modalSelector).modal("hide"),a(g.calendarSelector).fullCalendar("refetchEvents")):alert(g.failureUpdateEventMessage)},error:function(a){alert(g.failureUpdateEventMessage)}})},calendar.remove=function(b){var c="id="+b;a.ajax({type:"POST",url:g.ajaxRepeatCheck,data:{id:b},cache:!1,beforeSend:function(){a(".loadingDiv").show()},error:function(){a(".loadingDiv").hide(),alert(g.ajaxError)},success:function(d){a(".loadingDiv").hide(),"REP_FOUND"==d?(a(g.modalSelector).modal("hide"),a(g.modalPromptSelector+" .modal-header").html("<h4>"+g.eventText+calendar.title+"</h4>"),a(g.modalPromptSelector+" .modal-body").html(g.repetitiveEventActionText),a(g.modalPromptSelector).modal("show"),a('[data-option="remove-this"]').unbind("click").on("click",function(b){calendar.remove_this(c),a(g.modalPromptSelector).modal("hide"),b.preventDefault()}),a('[data-option="remove-repetitives"]').unbind("click").on("click",function(c){var d="id="+b+"&rep_id="+calendar.rep_id+"&method=repetitive_event";calendar.remove_this(d),a(g.modalPromptSelector).modal("hide"),c.preventDefault()})):calendar.remove_this(c)},error:function(a){alert(g.generalFailureMessage)}})},calendar.remove_this=function(b){a.ajax({type:"POST",url:g.ajaxEventDelete,data:b,cache:!1,beforeSend:function(){a(".loadingDiv").show()},error:function(){a(".loadingDiv").hide(),alert(g.ajaxError)},success:function(b){a(".loadingDiv").hide(),""==b?(a(g.modalSelector).modal("hide"),a(g.calendarSelector).fullCalendar("refetchEvents")):alert(g.failureDeleteEventMessage)}})},calendar.exportIcal=function(a,b,c,d,e){var f=d,h=e,i="&method=export&id="+encodeURIComponent(a)+"&title="+encodeURIComponent(b)+"&description="+encodeURIComponent(c)+"&start_date="+encodeURIComponent(f)+"&end_date="+encodeURIComponent(h);window.location=g.ajaxEventExport+i},calendar.calendarImport=function(){txt="import="+encodeURIComponent(a("#import_content").val()),a.post(g.ajaxImport,txt,function(b){alert(b),a(g.calendarSelector).fullCalendar("refetchEvents"),a("#cal_import").modal("hide"),a("#import_content").val("")})},calendar.removeObjProp=function(a,b){for(var c=0;c<b.length;c++)a.hasOwnProperty(b[c])&&delete a[b[c]]},1==g.filter&&(a(g.formFilterSelector).on("change",function(b){selected_value=a(this).val(),construct="filter="+encodeURIComponent(selected_value),a.post("includes/loader.php",construct,function(b){a(g.calendarSelector).fullCalendar("refetchEvents")}),b.preventDefault()}),a(g.formSearchSelector).keypress(function(a){13==a.which&&(h(),a.preventDefault())}),a(g.formSearchSelector+" button").on("click",function(a){h()}))}})}(jQuery);var calendar={};
